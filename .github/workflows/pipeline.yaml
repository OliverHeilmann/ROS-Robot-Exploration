name: ROS2 Build Pipeline

on:
  pull_request:
    branches:
      - main
      # - dev
  # push:
  #   branches:
  #     - main  # don't need to test on main because it's already tested on PR and main cannot be pushed to directly
  #     - dev

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      ROS_DISTRO: humble
    name: ${{ github.actor }} / ${{ github.event_name }} / ${{ github.workflow }} / ${{ github.run_number }}
    steps:
      - name: Checkout repository code
        uses: actions/checkout@v4
      
      - run: echo "The ${{ github.repository }} repository has been cloned to the runner."

      - name: Set up ROS2 and Husarian submodule
        run: |
          git submodule update --init --recursive
          sh setup.sh
        shell: bash

      - name: Build ROS2 project
        run: |
          source /opt/ros/${{ env.ROS_DISTRO }}/setup.bash
          colcon build --symlink-install

      - name: List output files
        run: |
          echo "Listing build output..."
          ls install/
